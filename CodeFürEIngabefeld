<?php
/**
 * Enables the User to create a Survey-Structure that is automatically translated into Question Groups and Links.
 *
 * @author Name <name@email.de>
 * @copyright Jahr Organisation <https://www.URL.de>
 * @license GPL v3
 * @version 1.0.0
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */
class Pendelstruktur extends PluginBase {
    
    protected $storage = 'DbStorage';
    static protected $description = 'Enables the User to create a Survey-Structure that is automatically translated into Question Groups and Links.';
    static protected $name = 'Pendelstruktur';
    
    public function init() {
        
        // Das erste Event erstellt das Formular, das zweite speichert die Einträge
        $this->subscribe('beforeSurveySettings');
        $this->subscribe('newSurveySettings');
    }
    
     //In dem Feld werden die Einstellungen gespeichert
     protected $settings = array(
     'bUse' => array(
     'type' => 'select',
     'options'=>array(
     0=>'Nein',
     1=>'Ja'
     ),
     'default'=>1,
     'label' => 'Willst du einen grafischen Strukturbaum?',
     'help'=>'Dies ist ein Test, der nichts bewirkt.',
     ),
     
     );
    
    public function beforeSurveySettings()
    {
        $oEvent = $this->event;
        $oEvent->set("surveysettings.{$this->id}", array(
            'name' => get_class($this),
            'settings' => array(
                'bUse' => array(
                    'type' => 'string',
                    'label' => 'Wie viele Gruppen haben Sie:',
                    'options'=>array(
                        0=> 'Nein',
                        1=> 'Ja',
                    ),
                    'default'=>1,
                    'help'=>'Anzahl unterschiedlicher Fragebögen',
                    'current'=> $this->get('bUse','Survey',$oEvent->get('survey')),
                ),
                
            ),
        ));
    }
    
    /**
     * Save the settings
     */
    public function newSurveySettings()
    {
        $event = $this->event;
        foreach ($event->get('settings') as $name => $value)
        {
            /* In order use survey setting, if not set, use global, if not set use default */
            $default=$event->get($name,null,null,isset($this->settings[$name]['default'])?$this->settings[$name]['default']:NULL);
            $this->set($name, $value, 'Survey', $event->get('survey'),$default);
        }
    }
    
    
    
}
